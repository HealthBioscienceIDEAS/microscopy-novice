<!DOCTYPE html>
<!-- START: inst/pkgdown/templates/layout.html --><!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><title>Image Analysis for Microscopy: Quality control and manual segmentation</title><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="stylesheet" type="text/css" href="assets/styles.css"><script src="assets/scripts.js" type="text/javascript"></script><!-- mathjax --><script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      config: ["MMLorHTML.js"],
      jax: ["input/TeX","input/MathML","output/HTML-CSS","output/NativeMML", "output/PreviewHTML"],
      extensions: ["tex2jax.js","mml2jax.js","MathMenu.js","MathZoom.js", "fast-preview.js", "AssistiveMML.js", "a11y/accessibility-menu.js"],
      TeX: {
        extensions: ["AMSmath.js","AMSsymbols.js","noErrors.js","noUndefined.js"]
      },
      tex2jax: {
        inlineMath: [['\\(', '\\)']],
        displayMath: [ ['$$','$$'], ['\\[', '\\]'] ],
        processEscapes: true
      }
    });
    </script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><!-- Responsive Favicon for The Carpentries --><link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png"><link rel="manifest" href="site.webmanifest"><link rel="mask-icon" href="safari-pinned-tab.svg" color="#5bbad5"><meta name="msapplication-TileColor" content="#da532c"><meta name="theme-color" content="#ffffff"></head><body>
    <header id="top" class="navbar navbar-expand-md navbar-light bg-white top-nav IDEAS"><a class="visually-hidden-focusable skip-link" href="#main-content">Skip to main content</a>
  <div class="container-fluid top-nav-container">
    <div class="col-md-6">
      <div class="large-logo">
        <img alt="IDEAS" src="assets/images/IDEAS-logo.svg"><abbr class="badge badge-light" title="This lesson is in the pre-alpha phase, which means that it is in early development, but has not yet been taught." style="background-color: #FF4955; border-radius: 5px">
          <a href="https://cdh.carpentries.org/the-lesson-life-cycle.html#early-development-pre-alpha-through-alpha" class="external-link alert-link" style="color: #000">
            <i aria-hidden="true" class="icon" data-feather="alert-octagon" style="border-radius: 5px"></i>
            Pre-Alpha
          </a>
          <span class="visually-hidden">This lesson is in the pre-alpha phase, which means that it is in early development, but has not yet been taught.</span>
        </abbr>

      </div>
    </div>
    <div class="selector-container">


      <div class="dropdown">
        <button class="btn btn-secondary dropdown-toggle bordered-button" type="button" id="dropdownMenu1" data-bs-toggle="dropdown" aria-expanded="false">
          <i aria-hidden="true" class="icon" data-feather="eye"></i> Learner View <i data-feather="chevron-down"></i>
        </button>
        <ul class="dropdown-menu" aria-labelledby="dropdownMenu1"><li><button class="dropdown-item" type="button" onclick="window.location.href='instructor/quality-control-and-manual-segmentation.html';">Instructor View</button></li>
        </ul></div>
    </div>
  </div>
  <hr></header><nav class="navbar navbar-expand-xl navbar-light bg-white bottom-nav IDEAS" aria-label="Main Navigation"><div class="container-fluid nav-container">
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle Navigation">
      <span class="navbar-toggler-icon"></span>
      <span class="menu-title">Menu</span>
    </button>
    <div class="nav-logo">
      <img class="small-logo" alt="IDEAS" src="assets/images/IDEAS-logo-sm.svg"></div>
    <div class="lesson-title-md">
      Image Analysis for Microscopy
    </div>
    <div class="search-icon-sm">
      <!-- TODO: do not show until we have search
        <i role="img" aria-label="Search the All In One page" data-feather="search"></i>
      -->
    </div>
    <div class="desktop-nav">
      <ul class="navbar-nav me-auto mb-2 mb-lg-0"><li class="nav-item">
          <span class="lesson-title">
            Image Analysis for Microscopy
          </span>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="key-points.html">Key Points</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="reference.html#glossary">Glossary</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="profiles.html">Learner Profiles</a>
        </li>
        <li class="nav-item dropdown">
          <button class="nav-link dropdown-toggle" id="navbarDropdown" data-bs-toggle="dropdown" aria-expanded="false">
            More <i data-feather="chevron-down"></i>
          </button>
          <ul class="dropdown-menu" aria-labelledby="navbarDropdown"><li><a class="dropdown-item" href="reference.html">Reference</a></li>
          </ul></li>
      </ul></div>
    <!--
    <form class="d-flex col-md-2 search-form">
      <fieldset disabled>
      <input class="form-control me-2 searchbox" type="search" placeholder="" aria-label="">
        <button class="btn btn-outline-success tablet-search-button"  type="submit">
          <i class="search-icon" data-feather="search" role="img" aria-label="Search the All In One page"></i>
        </button>
      </fieldset>
    </form>
    -->
    <a class="btn btn-primary" href="aio.html" role="button" aria-label="Search the All In One page">Search the All In One page</a>
  </div><!--/div.container-fluid -->
</nav><div class="col-md-12 mobile-title">
  Image Analysis for Microscopy
</div>

<aside class="col-md-12 lesson-progress"><div style="width: 68%" class="percentage">
    68%
  </div>
  <div class="progress IDEAS">
    <div class="progress-bar IDEAS" role="progressbar" style="width: 68%" aria-valuenow="68" aria-label="Lesson Progress" aria-valuemin="0" aria-valuemax="100">
    </div>
  </div>
</aside><div class="container">
      <div class="row">
        <!-- START: inst/pkgdown/templates/navbar.html -->
<div id="sidebar-col" class="col-lg-4">
  <div id="sidebar" class="sidebar">
      <nav aria-labelledby="flush-headingEleven"><button role="button" aria-label="close menu" alt="close menu" aria-expanded="true" aria-controls="sidebar" class="collapse-toggle" data-collapse="Collapse " data-episodes="Episodes ">
          <i class="search-icon" data-feather="x" role="img"></i>
        </button>
        <div class="sidebar-inner">
          <div class="row mobile-row">
            <div class="col">
              <div class="sidenav-view-selector">
                <div class="accordion accordion-flush" id="accordionFlush9">
                  <div class="accordion-item">
                    <h2 class="accordion-header" id="flush-headingNine">
                      <button class="accordion-button collapsed" id="instructor" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseNine" aria-expanded="false" aria-controls="flush-collapseNine">
                        <i id="eye" aria-hidden="true" class="icon" data-feather="eye"></i> Learner View
                      </button>
                    </h2>
                    <div id="flush-collapseNine" class="accordion-collapse collapse" aria-labelledby="flush-headingNine" data-bs-parent="#accordionFlush2">
                      <div class="accordion-body">
                        <a href="instructor/quality-control-and-manual-segmentation.html">Instructor View</a>
                      </div>
                    </div>
                  </div><!--/div.accordion-item-->
                </div><!--/div.accordion-flush-->
              </div><!--div.sidenav-view-selector -->
            </div><!--/div.col -->

            <hr></div><!--/div.mobile-row -->

          <div class="accordion accordion-flush" id="accordionFlush11">
            <div class="accordion-item">

              <button id="chapters" class="accordion-button show" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseEleven" aria-expanded="false" aria-controls="flush-collapseEleven">
                <h2 class="accordion-header chapters" id="flush-headingEleven">
                  EPISODES
                </h2>
              </button>
              <div id="flush-collapseEleven" class="accordion-collapse show collapse" aria-labelledby="flush-headingEleven" data-bs-parent="#accordionFlush11">

                <div class="accordion-body">
                  <div class="accordion accordion-flush" id="accordionFlush1">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading1">
        <a href="index.html">Summary and Setup</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush2">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading2">
        <a href="imaging-software.html">1. Imaging Software</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush3">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading3">
        <a href="what-is-an-image.html">2. What is an image?</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush4">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading4">
        <a href="image-display.html">3. Image display</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush5">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading5">
        <a href="multi-dimensional-images.html">4. Multi-dimensional images</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush6">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading6">
        <a href="filetypes-and-metadata.html">5. Filetypes and metadata</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush7">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading7">
        <a href="designing-a-light-microscopy-experiment.html">6. Designing a light microscopy experiment</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush8">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading8">
        <a href="choosing-acquisition-settings.html">7. Choosing acquisition settings</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlushcurrent">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-headingcurrent">
      <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapsecurrent" aria-expanded="true" aria-controls="flush-collapsecurrent">
        <span class="visually-hidden">Current Chapter</span>
        <span class="current-chapter">
        8. Quality control and manual segmentation
        </span>
      </button>
    </div><!--/div.accordion-header-->

    <div id="flush-collapsecurrent" class="accordion-collapse collapse show" aria-labelledby="flush-headingcurrent" data-bs-parent="#accordionFlushcurrent">
      <div class="accordion-body">
        <ul><li><a href="#quality-control">Quality control</a></li>
<li><a href="#what-is-segmentation">What is segmentation?</a></li>
<li><a href="#how-are-segmentations-represented">How are segmentations represented?</a></li>
<li><a href="#how-to-create-segmentations">How to create segmentations?</a></li>
<li><a href="#manual-segmentation-in-napari">Manual segmentation in Napari</a></li>
<li><a href="#manual-vs-automated">Manual vs automated?</a></li>
        </ul></div><!--/div.accordion-body-->
    </div><!--/div.accordion-collapse-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush10">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading10">
        <a href="filters-and-thresholding.html">9. Filters and thresholding</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush11">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading11">
        <a href="instance-segmentation-and-measurements.html">10. Instance segmentation and measurements</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush12">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading12">
        <a href="additional-resources.html">11. Additional resources</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

                </div>
              </div>
            </div>

            <hr class="half-width"><div class="accordion accordion-flush resources" id="accordionFlush12">
              <div class="accordion-item">
                <h2 class="accordion-header" id="flush-headingTwelve">
                  <button class="accordion-button collapsed" id="resources" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseTwelve" aria-expanded="false" aria-controls="flush-collapseTwelve">
                    RESOURCES
                  </button>
                </h2>
                <div id="flush-collapseTwelve" class="accordion-collapse collapse" aria-labelledby="flush-headingTwelve" data-bs-parent="#accordionFlush12">
                  <div class="accordion-body">
                    <ul><li>
                        <a href="key-points.html">Key Points</a>
                      </li>
                      <li>
                        <a href="reference.html#glossary">Glossary</a>
                      </li>
                      <li>
                        <a href="profiles.html">Learner Profiles</a>
                      </li>
                      <li><a href="reference.html">Reference</a></li>
                    </ul></div>
                </div>
              </div>
            </div>
            <hr class="half-width resources"><a href="aio.html">See all in one page</a>


            <hr class="d-none d-sm-block d-md-none"><div class="d-grid gap-1">

            </div>
          </div><!-- /div.accordion -->
        </div><!-- /div.sidebar-inner -->
      </nav></div><!-- /div.sidebar -->
  </div><!-- /div.sidebar-col -->
<!-- END:   inst/pkgdown/templates/navbar.html-->

        <!-- START: inst/pkgdown/templates/content-instructor.html -->
  <div class="col-xl-8 col-lg-12 primary-content">
    <nav class="lesson-content mx-md-4" aria-label="Previous and Next Chapter"><!-- content for small screens --><div class="d-block d-sm-block d-md-none">
        <a class="chapter-link" href="choosing-acquisition-settings.html"><i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>Previous</a>
        <a class="chapter-link float-end" href="filters-and-thresholding.html">Next<i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i></a>
      </div>
      <!-- content for large screens -->
      <div class="d-none d-sm-none d-md-block">
        <a class="chapter-link" href="choosing-acquisition-settings.html" rel="prev">
          <i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>
          Previous: Choosing acquisition
        </a>
        <a class="chapter-link float-end" href="filters-and-thresholding.html" rel="next">
          Next: Filters and...
          <i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i>
        </a>
      </div>
      <hr></nav><main id="main-content" class="main-content"><div class="container lesson-content">
        <h1>Quality control and manual segmentation</h1>
        <p>Last updated on 2025-06-25 |

        <a href="https://github.com/HealthBioscienceIDEAS/microscopy-novice/edit/main/episodes/quality-control-and-manual-segmentation.md" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>



        <div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>

        

<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul><li>What is segmentation?</li>
<li>How do we manually segment images in Napari?</li>
</ul></div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul><li><p>Explain some common quality control steps e.g. assessing an
image’s histogram, checking clipping/dynamic range</p></li>
<li><p>Explain what a segmentation, mask and label image are</p></li>
<li><p>Create a label layer in Napari and use some of its manual
segmentation tools (e.g. paintbrush/fill bucket)</p></li>
</ul></div>
</div>
</div>
</div>
</div>
<p>For the next few episodes, we will work through an example of
counting the number of cells in an image.</p>
<p>First, let’s open one of Napari’s sample images with:<br><code>File &gt; Open Sample &gt; napari builtins &gt; Cells (3D + 2Ch)</code></p>
<figure><img src="fig/cells-napari.png" alt="A screenshot of a flourescence microscopy image  of some cells in Napari" class="figure mx-auto d-block"></figure><section><h2 class="section-heading" id="quality-control">Quality control<a class="anchor" aria-label="anchor" href="#quality-control"></a></h2>
<hr class="half-width"><p>The first step in any image processing workflow is always quality
control. We have to check that the images we acquired at the microscope
capture the features we are interested in, with a reasonable signal to
noise ratio (recall we discussed signal to noise ratio in the <a href="choosing-acquisition-settings.html#signal-to-noise-ratio">last
episode</a>).</p>
<p>In order to count our cells, we will need to see individual nuclei in
our images. As there is one nucleus per cell, we will use the nucleus
number as the equivalent of cell number. If we look at our cells image
in Napari, we can clearly see multiple cell nuclei in green. If we zoom
in we can see some noise (as a slight ‘graininess’ over the image), but
this doesn’t interfere with being able to see the locations or sizes of
all nuclei.</p>
<p>Next, it’s good practice to check the image histogram, as we covered
in the <a href="choosing-acquisition-settings.html#initial-quality-control">choosing
acquisition settings episode</a>. We’ll do this in the exercise
below:</p>
<div id="histogram-quality-control" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<span class="callout-header">Challenge</span>
<div id="histogram-quality-control" class="callout-inner">
<h3 class="callout-title">Histogram quality control</h3>
<div class="callout-content">
<p>Plot the image histogram with <code>napari matplotlib</code>:</p>
<ul><li>Do you see any issues with the histogram?</li>
</ul><p>If you need a refresher on how to use <code>napari matplotlib</code>,
check out the <a href="image-display.html#napari-plugins">image display
episode</a>. It may also be useful to zoom into parts of the image
histogram by clicking the <img src="https://raw.githubusercontent.com/matplotlib/napari-matplotlib/main/src/napari_matplotlib/icons/black/Zoom.png" alt="A screenshot of napari-matplotlib's zoom button" height="30" class="figure">
icon at the top of histogram, then clicking and dragging a box around
the region you want to zoom into. You can reset your histogram by
clicking the <img src="https://raw.githubusercontent.com/matplotlib/napari-matplotlib/main/src/napari_matplotlib/icons/black/Home.png" alt="A screenshot of napari-matplotlib's home button" height="30" class="figure">
icon.</p>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1"> Show me the solution </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" data-bs-parent="#accordionSolution1" aria-labelledby="headingSolution1">
<div class="accordion-body">
<p>In the top menu bar of Napari select:<br><code>Plugins &gt; napari Matplotlib &gt; Histogram</code></p>
<p>Make sure you have the ‘nuclei’ layer selected in the layer list
(should be highlighted in blue).</p>
<figure><img src="fig/nuclei-histogram.png" alt="A histogram of the 29th z slice of Napari's  cell sample image" class="figure mx-auto d-block"></figure><div id="z-slices-and-contrast-limits" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<span class="callout-header">Callout</span>
<div id="z-slices-and-contrast-limits" class="callout-inner">
<h3 class="callout-title">Z slices and contrast limits</h3>
<div class="callout-content">
<p>Note that as this image is 3D <code>napari matplotlib</code> only
shows the histogram of the current z slice (in this case z=29 as shown
at the top of the histogram). Moving the slider at the bottom of the
viewer, will update the histogram to show different slices.</p>
<p>The vertical white lines at the left and right of the histogram
display the current contrast limits as set in the layer controls. Note
that by default Napari isn’t using the full image range as the contrast
limits. We can change this by right clicking on the contrast limits
slider and selecting the ‘reset’ button on the right hand side. This
will set the contrast limits to the min/max pixel value of the current z
slice. If we instead want to use the full 16-bit range from 0-65535, we
can instead click the ‘full range’ button, then drag the contrast limit
nodes to each end of the slider.</p>
</div>
</div>
</div>
<p>First, are there pixel values spread over most of the possible range?
We can check what range is possible by printing the image’s data type to
the console:</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a>nuclei <span class="op">=</span> viewer.layers[<span class="st">"nuclei"</span>].data</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="bu">print</span>(nuclei.dtype)</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code><span><span class="va">uint16</span></span></code></pre>
</div>
<p>This shows the image is an unsigned integer 16-bit image, which has a
pixel value range from 0-65535 (as we covered in the <a href="what-is-an-image.html#bit-depth">‘What is an image?’ episode</a>).
This matches the range on the x axis of our napari-matplotlib
histogram.</p>
<p>If we look at the brightest part of the image, near z=29, we can see
that there are indeed pixel values over much of this possible range. At
first glance, it may seem like there are no values at the right side of
the histogram, but if we zoom in using the <img src="https://raw.githubusercontent.com/matplotlib/napari-matplotlib/main/src/napari_matplotlib/icons/black/Zoom.png" alt="A screenshot of napari-matplotlib's zoom button" height="30" class="figure">
icon we can clearly see pixels at these higher values.</p>
<figure><img src="fig/nuclei-histogram-zoom.png" alt="A histogram of the 29th z slice of  Napari's cell sample image - zoomed in to the range from 25000 to 60000" class="figure mx-auto d-block"></figure><p>Most importantly, we see no evidence for ‘clipping’, which means we
are avoiding any irretrievable loss of information this would cause.
Recall that clipping occurs when pixels are recording light above the
maximum limit for the image. Therefore, many values are ‘clipped’ to the
maximum value resulting in information loss.</p>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="what-is-segmentation">What is segmentation?<a class="anchor" aria-label="anchor" href="#what-is-segmentation"></a></h2>
<hr class="half-width"><p>In order to count the number of cells, we must ‘segment’ the nuclei
in this image. Segmentation is the process of labelling each pixel in an
image e.g. is that pixel part of a nucleus or not? Segmentation comes in
two main types - ‘semantic segmentation’ and ‘instance segmentation’. In
this section we’ll describe what both kinds of segmentation represent,
as well as how they relate to each other, using some simple
examples.</p>
<p>First, let’s take a quick look at a rough semantic segmentation. Open
Napari’s console by pressing the <img src="https://raw.githubusercontent.com/napari/napari/main/src/napari/resources/icons/console.svg" alt="A screenshot of Napari's console button" height="30" class="figure"> button,
then copy and paste the code below. Don’t worry about the details of
what’s happening in the code - we’ll look at some of these concepts like
gaussian blur and otsu thresholding in later episodes!</p>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="im">from</span> skimage.filters <span class="im">import</span> threshold_otsu, gaussian</span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a>image <span class="op">=</span> viewer.layers[<span class="st">"nuclei"</span>].data</span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a></span>
<span id="cb3-5"><a href="#cb3-5" tabindex="-1"></a>blurred <span class="op">=</span> gaussian(image, sigma<span class="op">=</span><span class="dv">3</span>)</span>
<span id="cb3-6"><a href="#cb3-6" tabindex="-1"></a>threshold <span class="op">=</span> threshold_otsu(blurred)</span>
<span id="cb3-7"><a href="#cb3-7" tabindex="-1"></a></span>
<span id="cb3-8"><a href="#cb3-8" tabindex="-1"></a>semantic_seg <span class="op">=</span> blurred <span class="op">&gt;</span> threshold</span>
<span id="cb3-9"><a href="#cb3-9" tabindex="-1"></a>viewer.add_labels(semantic_seg)</span></code></pre>
</div>
<figure><img src="fig/semantic-seg-napari.png" alt="A screenshot of a rough semantic  segmentation of nuclei in Napari" class="figure mx-auto d-block"></figure><p>You should see an image appear that highlights the nuclei in brown.
Try toggling the ‘semantic_seg’ layer on and off multiple times, by
clicking the <img src="https://raw.githubusercontent.com/napari/napari/main/src/napari/resources/icons/visibility.svg" alt="A screenshot of Napari's eye button" height="30" class="figure"> icon next
to its name in the layer list. You should see that the brown areas match
the nucleus boundaries reasonably well.</p>
<p>This is an example of a ‘semantic segmentation’. In a semantic
segmentation, pixels are grouped into different categories (also known
as ‘classes’). In this example, we have assigned each pixel to one of
two classes: <code>nuclei</code> or <code>background</code>.
Importantly, it doesn’t recognise which pixels belong to different
objects of the same category - for example, here we don’t know which
pixels belong to individual, separate nuclei. This is the role of
‘instance segmentation’ that we’ll look at next.</p>
<p>Copy and paste the code below into Napari’s console. Again, don’t
worry about the details of what’s happening here - we’ll look at some of
these concepts in later episodes.</p>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="im">from</span> skimage.morphology <span class="im">import</span> binary_erosion, ball</span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a><span class="im">from</span> skimage.segmentation <span class="im">import</span> expand_labels</span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a><span class="im">from</span> skimage.measure <span class="im">import</span> label</span>
<span id="cb4-4"><a href="#cb4-4" tabindex="-1"></a></span>
<span id="cb4-5"><a href="#cb4-5" tabindex="-1"></a>eroded <span class="op">=</span> binary_erosion(semantic_seg, footprint<span class="op">=</span>ball(<span class="dv">10</span>))</span>
<span id="cb4-6"><a href="#cb4-6" tabindex="-1"></a>instance_seg <span class="op">=</span> label(eroded)</span>
<span id="cb4-7"><a href="#cb4-7" tabindex="-1"></a>instance_seg <span class="op">=</span> expand_labels(instance_seg, distance<span class="op">=</span><span class="dv">10</span>)</span>
<span id="cb4-8"><a href="#cb4-8" tabindex="-1"></a></span>
<span id="cb4-9"><a href="#cb4-9" tabindex="-1"></a>viewer.add_labels(instance_seg)</span></code></pre>
</div>
<figure><img src="fig/instance-seg-napari.png" alt="A screenshot of a rough instance  segmentation of nuclei in Napari" class="figure mx-auto d-block"></figure><p>You should see an image appear that highlights nuclei in different
colours. Let’s hide the ‘semantic_seg’ layer by clicking the <img src="https://raw.githubusercontent.com/napari/napari/main/src/napari/resources/icons/visibility.svg" alt="A screenshot of Napari's eye button" height="30" class="figure"> icon next
to its name in Napari’s layer list. Then try toggling the ‘instance_seg’
layer on and off multiple times, by clicking the corresponding <img src="https://raw.githubusercontent.com/napari/napari/main/src/napari/resources/icons/visibility.svg" alt="A screenshot of Napari's eye button" height="30" class="figure"> icon. You
should see that the coloured areas match most of the nucleus boundaries
reasonably well, although there are some areas that are less well
labelled.</p>
<p>This image is an example of an ‘instance segmentation’ - it is
recognising which pixels belong to individual ‘instances’ of our
category (nuclei). This is the kind of segmentation we will need in
order to count the number of nuclei (and therefore the number of cells)
in our image.</p>
<p>Note that it’s common for instance segmentations to be created by
first making a semantic segmentation, then splitting it into individual
instances. This isn’t always the case though - it will depend on the
type of segmentation method you use.</p>
</section><section><h2 class="section-heading" id="how-are-segmentations-represented">How are segmentations represented?<a class="anchor" aria-label="anchor" href="#how-are-segmentations-represented"></a></h2>
<hr class="half-width"><p>How are segmentations represented in the computer? What pixel values
do they use?</p>
<p>First, let’s focus on the ‘semantic_seg’ layer we created
earlier:</p>
<ul><li>Click the <img src="https://raw.githubusercontent.com/napari/napari/main/src/napari/resources/icons/visibility.svg" alt="A screenshot of Napari's eye button" height="30" class="figure"> icon next
to ‘semantic_seg’ in the layer list to make it visible.</li>
<li>Click the <img src="https://raw.githubusercontent.com/napari/napari/main/src/napari/resources/icons/visibility.svg" alt="A screenshot of Napari's eye button" height="30" class="figure"> icon next
to ‘instance_seg’ in the layer list to hide it.</li>
<li>Make sure the ‘semantic_seg’ layer is selected in the layer list. It
should be highlighted in blue.</li>
</ul><p>Try hovering over the segmentation and examining the pixel values
down in the bottom left corner of the viewer. Recall that we looked at
pixel values in the <a href="what-is-an-image.html#pixels">‘What is an
image?’ episode</a>.</p>
<figure><img src="fig/pixel-value-segmentation.png" alt="A screenshot highlighting the pixel  value of a nuclei segmentation in Napari" class="figure mx-auto d-block"></figure><p>You should see that a pixel value of 0 is used for the background and
a pixel value of 1 is used for the nuclei. In fact, segmentations are
stored in the computer in the same way as a standard image - as an array
of pixel values. We can check this by printing the array into Napari’s
console, as we did in the <a href="what-is-an-image.html#images-are-arrays-of-numbers">‘What is an
image?’ episode</a>.</p>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="co"># Get the semantic segmentation data</span></span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a>image <span class="op">=</span> viewer.layers[<span class="st">'semantic_seg'</span>].data</span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" tabindex="-1"></a><span class="co"># Print the image values and type</span></span>
<span id="cb5-5"><a href="#cb5-5" tabindex="-1"></a><span class="bu">print</span>(image)</span>
<span id="cb5-6"><a href="#cb5-6" tabindex="-1"></a><span class="bu">print</span>(<span class="bu">type</span>(image))</span></code></pre>
</div>
<p>Note the output is shortened here to save space!</p>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[[[0 0 0 ... 0 0 0]
  [0 0 0 ... 0 0 0]
  [0 0 0 ... 0 0 0]
  ...

&lt;class 'numpy.ndarray'&gt;
</code></pre>
</div>
<p>The difference between this and a standard image, is in what the
pixel values represent. Here, they no longer represent the intensity of
light at each pixel, but rather the assignment of each pixel to
different categories or objects e.g.  0 = background, 1 = nuclei. You
can also have many more values, depending on the categories/objects you
are trying to represent. For example, we could have nucleus, cytoplasm,
cell membrane and background, which would give four possible values of
0, 1, 2 and 3.</p>
<p>Let’s take a look at the pixel values in the instance
segmentation:</p>
<ul><li>Click the <img src="https://raw.githubusercontent.com/napari/napari/main/src/napari/resources/icons/visibility.svg" alt="A screenshot of Napari's eye button" height="30" class="figure"> icon next
to ‘instance_seg’ in the layer list to make it visible.</li>
<li>Click the <img src="https://raw.githubusercontent.com/napari/napari/main/src/napari/resources/icons/visibility.svg" alt="A screenshot of Napari's eye button" height="30" class="figure"> icon next
to ‘semantic_seg’ in the layer list to hide it.</li>
<li>Make sure the ‘instance_seg’ layer is selected in the layer list. It
should be highlighted in blue.</li>
</ul><p>If you hover over the segmentation now, you should see that each
nucleus has a different pixel value. We can find the maximum value via
the console like so:</p>
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a><span class="co"># Get the instance segmentation data</span></span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a>image <span class="op">=</span> viewer.layers[<span class="st">'instance_seg'</span>].data</span>
<span id="cb7-3"><a href="#cb7-3" tabindex="-1"></a></span>
<span id="cb7-4"><a href="#cb7-4" tabindex="-1"></a><span class="co"># Print the maximum pixel value</span></span>
<span id="cb7-5"><a href="#cb7-5" tabindex="-1"></a><span class="bu">print</span>(image.<span class="bu">max</span>())</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code><span><span class="fl">19</span></span></code></pre>
</div>
<p>Instance segmentations tend to have many more pixel values, as there
is one per object ‘instance’. When working with images with very large
numbers of cells, you can quickly end up with hundreds or thousands of
pixel values in an instance segmentation.</p>
<p>So to summarise - segmentations are just images where the pixel
values represent specific categories, or individual instances of that
category. You will sometimes see them referred to as ‘label images’,
especially in the context of Napari. Segmentations with only two values
(e.g. 0 and 1 for background vs some specific category) are often
referred to as ‘masks’.</p>
<p>Note that in this episode we focus on segmentations where every pixel
is assigned to a specific class or instance. There are many segmentation
methods though that will instead output the <em>probability</em> of a
pixel belonging to a specific class or instance. These may be stored as
float images, where each pixel has a decimal value between 0 and 1
denoting their probability.</p>
<div id="segmentation-shapes-and-data-types" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<span class="callout-header">Challenge</span>
<div id="segmentation-shapes-and-data-types" class="callout-inner">
<h3 class="callout-title">Segmentation shapes and data types</h3>
<div class="callout-content">
<p>Copy and paste the following into Napari’s console:</p>
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a>nuclei <span class="op">=</span> viewer.layers[<span class="st">"nuclei"</span>].data</span>
<span id="cb9-2"><a href="#cb9-2" tabindex="-1"></a>semantic_seg <span class="op">=</span> viewer.layers[<span class="st">"semantic_seg"</span>].data</span>
<span id="cb9-3"><a href="#cb9-3" tabindex="-1"></a>instance_seg <span class="op">=</span> viewer.layers[<span class="st">"instance_seg"</span>].data</span></code></pre>
</div>
<ul><li><p>What shape are the <code>nuclei</code>, <code>semantic_seg</code>
and <code>instance_seg</code> images?</p></li>
<li><p>What pattern do you see in the shapes? Why?</p></li>
<li><p>What bit-depth do the <code>semantic_seg</code> and
<code>instance_seg</code> images have?</p></li>
<li><p>If I want to make an instance segmentation of 100 nuclei - what’s
the minimum bit depth I could use? (assume we’re storing unsigned
integers) Choose from 8-bit, 16-bit or 32-bit.</p></li>
<li><p>If I want to make an instance segmentation of 1000 nuclei -
what’s the minimum bit depth I could use? (assume we’re storing unsigned
integers) Choose from 8-bit, 16-bit or 32-bit.</p></li>
</ul><p>Recall that we looked at image shapes and bit-depths in the <a href="what-is-an-image.html">‘What is an image?’ episode</a>.</p>
</div>
</div>
</div>
<div id="accordionSolution2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution2" aria-expanded="false" aria-controls="collapseSolution2">
  <h4 class="accordion-header" id="headingSolution2"> Show me the solution </h4>
</button>
<div id="collapseSolution2" class="accordion-collapse collapse" data-bs-parent="#accordionSolution2" aria-labelledby="headingSolution2">
<div class="accordion-body">
<div class="section level3">
<h3 id="shapes-pattern">Shapes + pattern<a class="anchor" aria-label="anchor" href="#shapes-pattern"></a></h3>
<div class="codewrapper sourceCode" id="cb10">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a><span class="bu">print</span>(nuclei.shape)</span>
<span id="cb10-2"><a href="#cb10-2" tabindex="-1"></a><span class="bu">print</span>(semantic_seg.shape)</span>
<span id="cb10-3"><a href="#cb10-3" tabindex="-1"></a><span class="bu">print</span>(instance_seg.shape)</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>(60, 256, 256)
(60, 256, 256)
(60, 256, 256)</code></pre>
</div>
<p>All the images have the same shape of (60, 256, 256). This makes
sense as ‘semantic_seg’ and ‘instance_seg’ are segmentations made from
the nuclei image. Therefore, they need to be exactly the same size as
the nuclei image in order to assign a label to each pixel.</p>
<p>Note that even though the segmentation and image have the same shape,
they often won’t have the same filesize when saved. This is due to
segmentations containing many identical values (e.g. large parts of the
image might be 0, for background) meaning they can often be compressed
heavily without loss of information. Recall that we looked at
compression in the <a href="filetypes-and-metadata.html#compression">filetypes and metadata
episode</a>.</p>
</div>
<div class="section level3">
<h3 id="bit-depths">Bit depths<a class="anchor" aria-label="anchor" href="#bit-depths"></a></h3>
<div class="codewrapper sourceCode" id="cb12">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a><span class="bu">print</span>(semantic_seg.dtype)</span>
<span id="cb12-2"><a href="#cb12-2" tabindex="-1"></a><span class="bu">print</span>(instance_seg.dtype)</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code><span><span class="va">int8</span></span>
<span><span class="va">int32</span></span></code></pre>
</div>
<p>The data type (<code>.dtype</code>) of ‘semantic_seg’ contains the
number 8, showing that it is an 8-bit image. The data type of
‘instance_seg’ contains the number 32, showing that it is a 32-bit
image.</p>
<p>Note that in this case, as the instance segmentation only contains 19
nuclei, it could also have been stored as 8-bit (and probably should
have been, as this would provide a smaller file size!). The bit depth
was increased by some of the image processing operations used to
generate the instance segmentation, which is a common side effect as
we’ll discuss in the <a href="filters-and-thresholding.html#thresholding-the-blurred-image">next
episode</a>. If we wanted to reduce the bit depth, we could right click
on the ‘instance_seg’ layer in the layer list, then select
<code>Convert data type</code>. For more complex conversions, we would
need to use python commands in Napari’s console - e.g. see the <a href="https://bioimagebook.github.io/chapters/1-concepts/3-bit_depths/python.html" class="external-link">‘Python:
Types and bit-depths’</a> chapter form Pete Bankhead’s bioimage
book.</p>
</div>
<div class="section level3">
<h3 id="bit-depth-for-100-nuclei">Bit depth for 100 nuclei<a class="anchor" aria-label="anchor" href="#bit-depth-for-100-nuclei"></a></h3>
<p>To store an instance segmentation of 100 nuclei, we need to store
values from 0-100 (with convention being that 0 represents the
background pixels, and the rest are values for individual nuclei). An
8-bit unsigned integer image can store values from 0-255 and would
therefore be sufficient in this case.</p>
</div>
<div class="section level3">
<h3 id="bit-depth-for-1000-nuclei">Bit depth for 1000 nuclei<a class="anchor" aria-label="anchor" href="#bit-depth-for-1000-nuclei"></a></h3>
<p>To store an instance segmentation of 1000 nuclei, we need to store
values from 0-1000 (with 0 being the background, and the rest values for
individual nuclei). A 16-bit unsigned integer image can store values
from 0-65535 and would therefore be sufficient in this case.</p>
</div>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="how-to-create-segmentations">How to create segmentations?<a class="anchor" aria-label="anchor" href="#how-to-create-segmentations"></a></h2>
<hr class="half-width"><p>There are many, many different methods for creating segmentations!
These range from fully manual methods where you ‘paint’ the pixels in
each category, to complicated automated methods relying on classical
machine learning or deep learning models. The best method to use will
depend on your research question and the type of images you have in your
datasets. As we’ve mentioned before, it’s usually best to use the
simplest method that works well for your data. In this episode we’ll
look at manual methods for segmentation within Napari, before moving on
to more automated methods in later episodes.</p>
</section><section><h2 class="section-heading" id="manual-segmentation-in-napari">Manual segmentation in Napari<a class="anchor" aria-label="anchor" href="#manual-segmentation-in-napari"></a></h2>
<hr class="half-width"><p>Let’s look at how we can create our own segmentations in Napari.
First remove the two segmentation layers:</p>
<ul><li>Click on ‘instance_seg’, then <kbd>shift</kbd> + click
‘semantic_seg’</li>
<li>Click the <img src="https://raw.githubusercontent.com/napari/napari/main/src/napari/resources/icons/delete.svg" alt="A screenshot of Napari's delete layer button" height="30" class="figure">
icon to remove these layers.</li>
</ul><p>Then click on the <img src="https://raw.githubusercontent.com/napari/napari/main/src/napari/resources/icons/new_labels.svg" alt="A screenshot of Napari's labels layer button" height="30" class="figure">
icon (at the top of the layer list) to create a new <code>Labels</code>
layer.</p>
<p>Recall from the <a href="imaging-software.html#layer-list">imaging
software episode</a>, that Napari supports different kinds of layers.
For example, <code>Image</code> layers for standard images,
<code>Point</code> layers for points, <code>Shape</code> layers for
shapes like rectangles, ellipses or lines etc… <code>Labels</code>
layers are the type used for segmentations, and provide access to many
new settings in the layer controls:</p>
<figure><img src="fig/label-layer-controls.png" alt="A screenshot of the layer controls for  labels layers in Napari" class="figure mx-auto d-block"></figure><p>Let’s start by painting an individual nucleus. Select the paintbrush
by clicking the <img src="https://raw.githubusercontent.com/napari/napari/main/src/napari/resources/icons/paint.svg" alt="A screenshot of Napari's paintbrush button" height="30" class="figure"> icon
in the top row of the layer controls. Then click and drag across the
image to label pixels. You can change the size of the brush using the
‘brush size’ slider in the layer controls. To return to normal movement,
you can click the <img src="https://raw.githubusercontent.com/napari/napari/main/src/napari/resources/icons/pan_arrows.svg" alt="A screenshot of Napari's pan arrows button" height="30" class="figure"> icon
in the top row of the layer controls, or hold down spacebar to activate
it temporarily (this is useful if you want to pan slightly while
painting). To remove painted areas, you can activate the label eraser by
clicking the <img src="https://raw.githubusercontent.com/napari/napari/main/src/napari/resources/icons/erase.svg" alt="A screenshot of Napari's erase button" height="30" class="figure"> icon.</p>
<figure><img src="fig/single-painted-nucleus.png" alt="A screenshot of a single manually  painted nucleus in Napari" class="figure mx-auto d-block"></figure><p>If you hover over the image and examine the pixel values, you will
see that all your painted areas have a pixel value of 1. This
corresponds to the number shown next to ‘label:’ in the layer
controls.</p>
<p>To paint with a different pixel value, either click the + icon on the
right side of this number, or type another value into the box. Let’s
paint another nucleus with a pixel value of 2:</p>
<figure><img src="fig/two-painted-nuclei.png" alt="A screenshot of two manually painted nuclei  in Napari" class="figure mx-auto d-block"></figure><p>When you paint with a new value, you’ll see that Napari automatically
assigns it a new colour. This is because <code>Labels</code> layers use
<a href="https://napari.org/stable/howtos/layers/labels.html#shuffling-label-colors" class="external-link">a
special colormap/LUT for their pixel values</a>. Recall from the <a href="image-display.html#colormaps-luts">image display episode</a> that
colormaps are a way to convert pixel values into corresponding colours
for display. The colormap for <code>Labels</code> layers will assign
random colours to each pixel value, trying to ensure that nearby values
(like 2 vs 3) are given dissimilar colours. This helps to make it easier
to distinguish different labels. You can shuffle the colours used by
clicking the <img src="https://raw.githubusercontent.com/napari/napari/main/src/napari/resources/icons/shuffle.svg" alt="A screenshot of Napari's shuffle button" height="30" class="figure"> icon in
the top row of the layer controls. Note that the pixel value of 0 will
always be shown as transparent - this is because it is usually used to
represent the background.</p>
<div id="manual-segmentation-in-napari-1" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<span class="callout-header">Challenge</span>
<div id="manual-segmentation-in-napari-1" class="callout-inner">
<h3 class="callout-title">Manual segmentation in Napari</h3>
<div class="callout-content">
<p>Try labelling more individual nuclei in this image, making sure each
gets its own pixel value (label). Investigate the other settings in the
layer controls:</p>
<ul><li>What does the <img src="https://raw.githubusercontent.com/napari/napari/main/src/napari/resources/icons/fill.svg" alt="A screenshot of Napari's fill button" height="30" class="figure"> icon
do?</li>
<li>What does the <img src="https://raw.githubusercontent.com/napari/napari/main/src/napari/resources/icons/picker.svg" alt="A screenshot of Napari's picker button" height="30" class="figure"> icon
do?</li>
<li>What does the ‘contour’ setting control?</li>
<li>What does the ‘n edit dim’ setting control?</li>
<li>What does the ‘preserve labels’ setting control?</li>
</ul><p>Remember that you can hover over buttons to see a helpful popup with
some more information. You can also look in <a href="https://napari.org/stable/howtos/layers/labels.html" class="external-link">Napari’s
documentation</a> on <code>Labels</code> layers.</p>
<p>Note that if you make a mistake you can use <kbd>Ctrl</kbd> +
<kbd>Z</kbd> to undo your last action. If you need to re-do it use
<kbd>Shift</kbd> + <kbd>Ctrl</kbd> + <kbd>Z</kbd>.</p>
</div>
</div>
</div>
<div id="accordionSolution3" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution3" aria-expanded="false" aria-controls="collapseSolution3">
  <h4 class="accordion-header" id="headingSolution3"> Show me the solution </h4>
</button>
<div id="collapseSolution3" class="accordion-collapse collapse" data-bs-parent="#accordionSolution3" aria-labelledby="headingSolution3">
<div class="accordion-body">
<div class="section level3">
<h3 id="icon">
<img src="https://raw.githubusercontent.com/napari/napari/main/src/napari/resources/icons/fill.svg" alt="A screenshot of Napari's fill button" height="30" class="figure"> icon<a class="anchor" aria-label="anchor" href="#icon"></a></h3>
<p>This icon activates the ‘fill bucket’. It will fill whatever label
you click on with the currently active label (as shown next to ‘label:’
in the layer controls). For example, if your active label is 2, then
clicking on a nucleus with label 1 will change it to 2. You can see more
details about the fill bucket in <a href="https://napari.org/stable/howtos/layers/labels.html#using-the-fill-bucket" class="external-link">Napari’s
documentation</a></p>
</div>
<div class="section level3">
<h3 id="icon-1">
<img src="https://raw.githubusercontent.com/napari/napari/main/src/napari/resources/icons/picker.svg" alt="A screenshot of Napari's picker button" height="30" class="figure">
icon<a class="anchor" aria-label="anchor" href="#icon-1"></a></h3>
<p>This icon activates the ‘colour picker’. This allows you to click on
a pixel in the viewer and immediately select the corresponding label.
This is especially useful when you have hundreds of labels, which can
make them difficult to keep track of with the ‘label:’ option only.</p>
</div>
<div class="section level3">
<h3 id="contour">Contour<a class="anchor" aria-label="anchor" href="#contour"></a></h3>
<p>The contour setting controls how labels are displayed. By default
(when 0), labelled pixels are displayed as solid colours. Increasing the
contour value to one or higher, will change this to show the outline of
labelled regions instead. Higher values will result in a thicker
outline. This can be useful if you don’t want to obscure the underlying
image while viewing your segmentation.</p>
</div>
<div class="section level3">
<h3 id="n-edit-dim">n edit dim<a class="anchor" aria-label="anchor" href="#n-edit-dim"></a></h3>
<p>This controls the number of dimensions that are used for editing
labels. By default, this is 2 so all painting and editing of the
<code>Labels</code> layer will only occur in 2D. If you want to
paint/edit in 3D you can increase this to 3. Now painting will not only
affect the currently visible image slice, but slices above and below it
also. Be careful with the size of your brush when using this option!</p>
</div>
<div class="section level3">
<h3 id="preserve-labels">preserve labels<a class="anchor" aria-label="anchor" href="#preserve-labels"></a></h3>
<p>Activating ‘preserve labels’ will ensure that any painting/erasing
you do will only affect your currently active label. This is especially
useful if you need to paint very close to existing labels without
affecting them.</p>
</div>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="manual-vs-automated">Manual vs automated?<a class="anchor" aria-label="anchor" href="#manual-vs-automated"></a></h2>
<hr class="half-width"><p>Now that we’ve done some manual segmentation in Napari, you can
probably tell that this is a very slow and time consuming process
(especially if you want to segment in full 3D!). It’s also difficult to
keep the segmentation fully consistent, especially if multiple people
are contributing to it. For example, it can be difficult to tell exactly
where the boundary of a nucleus should be placed, as there may be a
gradual fall off in pixel intensity at the edge rather than a sharp
drop.</p>
<p>Due to these challenges, full manual segmentation is generally only
suitable for small images in small quantities. If we want to efficiently
scale to larger images in large quantities, then we need more automated
methods. We’ll look at some of these in the next few episodes, where we
investigate some ‘classic’ image processing methods that generate
segmentations directly from image pixel values. These automated
approaches will also help us achieve a less variable segmentation, that
segments objects in a fully consistent way.</p>
<p>For more complex segmentation scenarios, where the boundaries between
objects are less clear, we may need to use machine learning or deep
learning models. These models learn to segment images based on provided
‘groundtruth’ data. This ‘groundtruth’ is usually many small, manually
segmented patches of our images of interest. While generating this
manual groundtruth is still slow and time consuming, the advantage is
that we only need to segment a small subset of our images (rather than
the entire thing). Also, once the model is trained, it can be re-used on
similar image data.</p>
<p>It’s worth bearing in mind that automated methods are rarely perfect
(whether they’re classic image processing, machine learning or deep
learning based). It’s very likely that you will have to do some manual
segmentation cleanup from time to time.</p>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<span class="callout-header">Key Points</span>
<div class="callout-inner">
<div class="callout-content">
<ul><li><p>The first step in any image processing workflow is quality
control. For example, checking the histograms of your images.</p></li>
<li><p>Segmentation is the process of identifying what each pixel in an
image represents e.g. is that pixel part of a nucleus or not?</p></li>
<li><p>Segmentation can be broadly split into ‘semantic segmentation’
and ‘instance segmentation’. Semantic segmentation assigns pixels to
specific classes (like nuclei or background), while instance
segmentation assigns pixels to individual ‘instances’ of a class (like
individual nuclei).</p></li>
<li><p>Segmentations are represented in the computer in the same way as
standard images. The difference is that pixel values represent classes
or instances, rather than light intensity.</p></li>
<li><p>Napari uses <code>Labels</code> layers for segmentations. These
offer various annotation tools like the paintbrush, fill bucket
etc.</p></li>
<li><p>Fully manual segmentation is generally only suitable for small
images. More automated approaches (based on classic image processing,
machine learning or deep learning) are necessary to scale to larger
images. Even with automated methods, manual segmentation is often still
a key component - both for generating groundtruth data and cleaning up
problematic areas of the final segmentation.</p></li>
</ul></div>
</div>
</div>
<!--
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use.
 -->
</section></div> <!-- / div.lesson-content -->
    </main><!-- / main#main-content.main-content --><nav class="bottom-pagination mx-md-4" aria-label="Previous and Next Chapter"><div class="d-block d-sm-block d-md-none">
        <a class="chapter-link" href="choosing-acquisition-settings.html"><i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>Previous</a>
        <a class="chapter-link float-end" href="filters-and-thresholding.html">Next<i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i></a>
      </div>
      <!-- content for large screens -->
      <div class="d-none d-sm-none d-md-block">
        <a class="chapter-link" href="choosing-acquisition-settings.html" rel="prev">
          <i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>
          Previous: Choosing acquisition
        </a>
        <a class="chapter-link float-end" href="filters-and-thresholding.html" rel="next">
          Next: Filters and...
          <i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i>
        </a>
      </div>
    </nav></div> <!-- / div.primary-content.col-xs-12 -->
<!-- END:   inst/pkgdown/templates/content-instructor.html-->

      </div><!--/div.row-->
      		<footer class="row footer mx-md-3"><hr><div class="col-md-6">
        <p>This lesson is subject to the <a href="CODE_OF_CONDUCT.html">Code of Conduct</a></p>
        <p>

        <a href="https://github.com/HealthBioscienceIDEAS/microscopy-novice/edit/main/episodes/quality-control-and-manual-segmentation.md" class="external-link">Edit on GitHub</a>

	
        | <a href="https://github.com/HealthBioscienceIDEAS/microscopy-novice/blob/main/CONTRIBUTING.md" class="external-link">Contributing</a>
        | <a href="https://github.com/HealthBioscienceIDEAS/microscopy-novice/" class="external-link">Source</a></p>
				<p><a href="https://github.com/HealthBioscienceIDEAS/microscopy-novice/blob/main/CITATION" class="external-link">Cite</a> | <a href="mailto:team@carpentries.org">Contact</a> | <a href="https://carpentries.org/about/" class="external-link">About</a></p>
			</div>
			<div class="col-md-6">

        <p>Materials licensed under <a href="LICENSE.html">CC-BY 4.0</a> by the authors</p>

        <p>Template licensed under <a href="https://creativecommons.org/licenses/by-sa/4.0/" class="external-link">CC-BY 4.0</a> by <a href="https://carpentries.org/" class="external-link">The Carpentries</a></p>
        <p>Built with <a href="https://github.com/carpentries/sandpaper/tree/0.17.1" class="external-link">sandpaper (0.17.1)</a>, <a href="https://github.com/carpentries/pegboard/tree/0.7.9" class="external-link">pegboard (0.7.9)</a>, and <a href="https://github.com/HealthBioscienceIDEAS/varnish/tree/IDEAS" class="external-link">varnish (1.0.3.9000)</a></p>
			</div>
		</footer></div> <!-- / div.container -->
	<div id="to-top">
		<a href="#top">
      <i class="search-icon" data-feather="arrow-up" role="img" aria-label="Back To Top"></i><br><!-- <span class="d-none d-sm-none d-md-none d-lg-none d-xl-block">Back</span> To Top --><span class="d-none d-sm-none d-md-none d-lg-none d-xl-block">Back</span> To Top
		</a>
	</div>
  <script type="application/ld+json">
    {
  "@context": "https://schema.org",
  "@type": "LearningResource",
  "@id": "https://HealthBioscienceIDEAS.github.io/microscopy-novice/quality-control-and-manual-segmentation.html",
  "inLanguage": "en",
  "dct:conformsTo": "https://bioschemas.org/profiles/LearningResource/1.0-RELEASE",
  "description": "A Carpentries Lesson teaching foundational data and coding skills to researchers worldwide",
  "keywords": "software, data, lesson, The Carpentries",
  "name": "Quality control and manual segmentation",
  "creativeWorkStatus": "active",
  "url": "https://HealthBioscienceIDEAS.github.io/microscopy-novice/quality-control-and-manual-segmentation.html",
  "identifier": "https://HealthBioscienceIDEAS.github.io/microscopy-novice/quality-control-and-manual-segmentation.html",
  "dateCreated": "2023-10-26",
  "dateModified": "2025-06-25",
  "datePublished": "2025-10-31"
}

  </script><script>
		feather.replace();
	</script></body></html><!-- END:   inst/pkgdown/templates/layout.html-->

